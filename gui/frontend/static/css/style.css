@echo off
setlocal EnableDelayedExpansion

REM --- Configuration ---
set "VENV_NAME=venv"
set "PYTHON_EXECUTABLE=python"
REM If "python" doesn't work, change the above to "python3".
set "BACKEND_SCRIPT=gui/backend/main:app"
set "UVICORN_OPTIONS=--reload --port 8001"
set "BROWSER_URL=http://localhost:8001"

REM --- Change to the script's directory ---
cd /d "%~dp0"
echo Current directory: %cd%

REM --- Create virtual environment if it doesn't exist ---
if not exist "%VENV_NAME%\Scripts\activate.bat" (
    echo Creating virtual environment "%VENV_NAME%"...
    %PYTHON_EXECUTABLE% -m venv "%VENV_NAME%"
    if errorlevel 1 (
        echo ERROR: Could not create virtual environment.
        pause
        exit /b 1
    )
)

REM --- Activate the virtual environment ---
call "%VENV_NAME%\Scripts\activate.bat"
if errorlevel 1 (
    echo ERROR: Could not activate virtual environment.
    pause
    exit /b 1
)

REM --- Upgrade pip and install required packages ---
echo Installing/updating required packages...
pip install --upgrade pip
pip install fastapi uvicorn jinja2

REM --- Launch the FastAPI GUI backend in a new console window ---
echo Starting the GUI backend...
start "GUI Backend" %PYTHON_EXECUTABLE% -m uvicorn %BACKEND_SCRIPT% %UVICORN_OPTIONS%

REM --- Give the server a few seconds to start up ---
timeout /t 3 > nul

REM --- Automatically open the default browser ---
echo Launching browser at %BROWSER_URL%...
start "" "%BROWSER_URL%"

echo.
echo GUI is running! You can close this window if desired.
pause
endlocal
