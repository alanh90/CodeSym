<!DOCTYPE html>
<html>
<head>
    <title>CodeSym</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', path='/css/style.css') }}">
</head>
<body>
    <h1>CodeSym Control Panel</h1>
    <button id="runButton">Run CodeSym</button>
    <div id="output"></div>

    <script>
        const runButton = document.getElementById("runButton");
        const outputDiv = document.getElementById("output");
        let pollingInterval = null;

        runButton.addEventListener("click", async () => {
            outputDiv.textContent = "Running...";

            // Start CodeSym (non-blocking)
            const startResponse = await fetch("/run_codesym", { method: "POST" });
            const startData = await startResponse.json();

            if (startData.status === "success") {
                // Start polling for output
                pollingInterval = setInterval(async () => {
                    const outputResponse = await fetch("/get_output");
                    const outputData = await outputResponse.json();

                    if (outputData.status === "success") {
                        outputDiv.textContent = outputData.output;
                    } else {
                        outputDiv.textContent = "Error: " + outputData.message;
                        clearInterval(pollingInterval); // Stop polling on error
                    }
                }, 500); // Poll every 500 milliseconds (0.5 seconds)
            } else {
                outputDiv.textContent = "Error starting CodeSym: " + startData.message;
            }
        });
    </script>
</body>
</html>